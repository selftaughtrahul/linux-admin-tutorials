# Linux Logging and Auditing

## Introduction

Linux logging and auditing help administrators monitor system activities, detect issues, and ensure security compliance.  
This guide covers:

- What is Logging?
- Common Linux Log Files
- Managing Log Files with `rsyslog`
- Log Rotation with `logrotate`
- Introduction to System Auditing
- Auditing with `auditd`
- Interview Questions

---

## What is Logging?

Logging is the process of recording events and messages generated by the system, services, and applications.  
Logs are crucial for:

- Troubleshooting issues
- Monitoring system activity
- Auditing user actions
- Security investigations

---

## Common Linux Log Files

| Log File                  | Purpose |
|----------------------------|---------|
| `/var/log/messages`        | General system messages |
| `/var/log/syslog`          | System activity logs (Debian/Ubuntu) |
| `/var/log/auth.log`        | Authentication logs (Debian/Ubuntu) |
| `/var/log/secure`          | Authentication logs (RHEL/CentOS) |
| `/var/log/dmesg`           | Kernel ring buffer messages |
| `/var/log/boot.log`        | Boot process logs |
| `/var/log/cron`            | Cron job logs |
| `/var/log/httpd/`          | Apache web server logs |
| `/var/log/audit/audit.log` | Security audit logs |

---

## Managing Log Files with `rsyslog`

`rsyslog` is a powerful tool for forwarding and storing log messages.

### 1. Install `rsyslog`

```bash
sudo apt install rsyslog        # Debian/Ubuntu
sudo yum install rsyslog        # RHEL/CentOS
```

### 2. Configuration File

Main config: `/etc/rsyslog.conf`

Example: Forward logs to a remote server

```bash
*.* @192.168.1.100:514
```

Restart service:

```bash
sudo systemctl restart rsyslog
```

---

## Log Rotation with `logrotate`

`logrotate` manages automatic rotation, compression, and deletion of log files.

### 1. Install `logrotate`

```bash
sudo apt install logrotate      # Debian/Ubuntu
sudo yum install logrotate      # RHEL/CentOS
```

### 2. Basic Configuration

Default config file: `/etc/logrotate.conf`  
Custom configs: `/etc/logrotate.d/`

Example configuration:

```bash
/var/log/syslog {
    rotate 7
    daily
    compress
    missingok
    notifempty
}
```

- **rotate 7**: Keep 7 old log files.
- **daily**: Rotate logs daily.
- **compress**: Compress old logs.

Test rotation manually:

```bash
sudo logrotate --debug /etc/logrotate.conf
```

---

## Introduction to System Auditing

Auditing tracks events related to security, such as:

- User logins and logouts
- File access attempts
- System calls

Auditing is important for:

- Security compliance (e.g., PCI-DSS, HIPAA)
- Forensic investigations

---

## Auditing with `auditd`

The Linux Audit Daemon (`auditd`) records audit events.

### 1. Install `auditd`

```bash
sudo apt install auditd
sudo yum install audit
```

Start and enable the service:

```bash
sudo systemctl start auditd
sudo systemctl enable auditd
```

### 2. Basic Commands

- View audit logs:

```bash
sudo ausearch -x /bin/ssh
```

- Audit a specific file:

```bash
sudo auditctl -w /etc/passwd -p wa -k passwd_changes
```

- Explanation:
  - `-w`: Watch file
  - `-p wa`: Monitor for write and attribute changes
  - `-k`: Add a custom key for easier search

- Search for events:

```bash
sudo ausearch -k passwd_changes
```

- Generate reports:

```bash
sudo aureport
```

### 3. Important Audit Files

| File                        | Purpose |
|------------------------------|---------|
| `/var/log/audit/audit.log`   | Main audit log file |
| `/etc/audit/audit.rules`     | Persistent audit rules |
| `/etc/audit/auditd.conf`     | Audit daemon configuration |

---

## Interview Questions

- What is the purpose of system logging?
- What is the difference between `syslog`, `rsyslog`, and `journald`?
- How does `logrotate` help manage disk space?
- What is `auditd` and how do you monitor file changes with it?
- How can you forward Linux logs to a remote server?
- What types of events should be audited for security compliance?
